<!DOCTYPE html>
<html lang="es">
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1" />
  <title>INFINITI KAPITAL — Journal</title>

  <!-- Estilos mínimos para que el modal funcione en cualquier tema -->
  <style>
    :root {
      --bg: #0b1220;
      --panel: #101826;
      --text: #e6edf3;
      --muted: #9fb0c0;
      --accent: #d4af37;
      --border: #1f2a3a;
      --danger: #ef4444;
      --success: #10b981;
    }

    html, body {
      margin: 0; padding: 0;
      background: var(--bg); color: var(--text);
      font-family: system-ui, -apple-system, Segoe UI, Roboto, Inter, Arial, sans-serif;
    }

    .container { max-width: 1200px; margin: 0 auto; padding: 20px; }

    header {
      display:flex; align-items:center; justify-content:space-between;
      padding: 16px 20px; border-bottom: 1px solid var(--border);
      position: sticky; top: 0; backdrop-filter: blur(6px);
      background: color-mix(in srgb, var(--bg) 85%, transparent);
      z-index: 10;
    }
    .brand { display:flex; gap:10px; align-items:center; font-weight:700; }
    .tag { background: var(--panel); padding:4px 8px; border:1px solid var(--border); border-radius: 999px; color: var(--accent); font-weight:700; }
    .btn {
      display:inline-flex; align-items:center; gap:8px;
      padding:10px 14px; border:1px solid var(--border); border-radius:10px;
      background: var(--panel); color: var(--text); cursor:pointer; text-decoration:none;
    }
    .btn:hover { border-color: color-mix(in srgb, var(--accent) 40%, var(--border)); }
    .btn-primary { background: var(--accent); color: #141414; border-color: var(--accent); font-weight: 700; }
    .btn-danger { background: transparent; border-color: #3a1f24; color: #ffb4be; }
    .grid { display:grid; gap:16px; grid-template-columns: repeat(12, 1fr); }
    .card { grid-column: span 6; background: var(--panel); border: 1px solid var(--border); border-radius: 14px; padding: 16px; }
    .card h3 { margin: 0 0 8px 0; font-size: 16px; color: var(--muted); }
    .big { font-size: 28px; font-weight: 800; color: var(--text); }

    /* Utilidades */
    .hidden { display: none !important; }
    .flex { display: flex !important; }

    /* Modal */
    .modal {
      position: fixed; inset: 0;
      background: rgba(0,0,0,.55);
      align-items: center; justify-content: center;
      z-index: 50;
    }
    .modal-panel {
      width: 100%; max-width: 520px;
      background: var(--panel); border: 1px solid var(--accent);
      border-radius: 14px; padding: 18px;
      box-shadow: 0 10px 40px rgba(0,0,0,.35);
    }
    .modal-header { display:flex; align-items:center; justify-content:space-between; margin-bottom: 12px; }
    .modal-title { font-size: 18px; font-weight: 800; color: var(--accent); }
    .form-row { margin: 10px 0; display:flex; flex-direction:column; gap:6px; }
    label { font-size: 13px; color: var(--muted); }
    input {
      height: 44px; border-radius: 10px; border: 1px solid var(--border);
      background: #0d1524; color: var(--text); padding: 0 12px; outline: none;
    }
    input:focus { border-color: color-mix(in srgb, var(--accent) 40%, var(--border)); }
    .actions { display:flex; gap:10px; justify-content: flex-end; margin-top: 8px; }
    .pill { padding: 6px 10px; border-radius: 999px; border:1px solid var(--border); background: #0d1524; color: var(--muted); display:inline-flex; align-items:center; gap:8px; }

    @media (max-width: 820px) {
      .card { grid-column: 1 / -1; }
      header { flex-wrap: wrap; gap: 10px; }
    }
  </style>
</head>
<body>

  <!-- Top bar -->
  <header>
    <div class="brand">
      <div>INFINITI</div>
      <div class="tag">KAPITAL</div>
    </div>
    <div class="actions">
      <button class="btn" id="btn-logout" title="Cerrar sesión" style="display:none;">Cerrar sesión</button>
      <button class="btn btn-primary" id="btn-login-open" title="Acceder">Acceder</button>
    </div>
  </header>

  <!-- Main -->
  <main class="container">
    <div class="pill">
      Bienvenido, <strong id="user-name">Invitado</strong>
      <span style="opacity:.6;">(modo invitado)</span>
    </div>

    <p id="welcome-message" style="color:var(--muted); margin: 10px 0 22px;">
      Inicia sesión para guardar tus operaciones en la nube.
    </p>

    <section class="grid">
      <div class="card">
        <h3>Resumen</h3>
        <div class="big">$0.00</div>
      </div>
      <div class="card">
        <h3>Factor</h3>
        <div class="big">0.00</div>
      </div>
      <div class="card">
        <h3>R/B</h3>
        <div class="big">0.00</div>
      </div>
      <div class="card">
        <h3>Ganadoras</h3>
        <div class="big">0</div>
      </div>
    </section>
  </main>

  <!-- Modal de autenticación -->
  <div id="auth-modal" class="modal hidden">
    <div class="modal-panel">
      <div class="modal-header">
        <div class="modal-title">Acceso</div>
        <button class="btn" id="btn-login-close">Cerrar</button>
      </div>

      <div class="form-row">
        <label for="login-email">Email</label>
        <input id="login-email" type="email" placeholder="tu@correo.com" />
      </div>

      <div class="form-row">
        <label for="login-pass">Contraseña</label>
        <input id="login-pass" type="password" placeholder="••••••••" />
      </div>

      <div class="actions">
        <button class="btn" id="btn-create-account">Crear cuenta</button>
        <button class="btn btn-primary" id="btn-login-submit">Entrar</button>
      </div>
    </div>
  </div>

  <!-- Firebase + Lógica (PLUG & PLAY) -->
  <script type="module">
    /* ===== Firebase ===== */
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-app.js';
    import {
      getAuth,
      onAuthStateChanged,
      signInWithEmailAndPassword,
      createUserWithEmailAndPassword,
      signOut,
    } from 'https://www.gstatic.com/firebasejs/10.12.5/firebase-auth.js';

    const firebaseConfig = {
      apiKey: "AIzaSyCuS-0g97JluGH6FTF5JBmwaW7d5aJ3WWw",
      authDomain: "journal-infiniti-kapital.firebaseapp.com",
      projectId: "journal-infiniti-kapital",
      storageBucket: "journal-infiniti-kapital.firebasestorage.app",
      messagingSenderId: "78211615687",
      appId: "1:78211615687:web:02b05ba83acd46c8c6e7e2",
      measurementId: "G-D0ERFPMLGQ"
    };

    const app  = initializeApp(firebaseConfig);
    const auth = getAuth(app);

    /* ===== Helpers de UI ===== */
    const $ = (s) => document.querySelector(s);
    const showModal  = () => { $('#auth-modal')?.classList.remove('hidden'); $('#auth-modal')?.classList.add('flex'); };
    const hideModal  = () => { $('#auth-modal')?.classList.add('hidden');   $('#auth-modal')?.classList.remove('flex'); };
    const emailVal   = () => $('#login-email')?.value.trim() || '';
    const passVal    = () => $('#login-pass')?.value || '';

    const ok  = (m) => alert(m);
    const err = (e) => alert(e?.message || e);

    /* ===== Enlaces de botones ===== */
    $('#btn-login-open')?.addEventListener('click', (e) => { e.preventDefault(); showModal(); });
    $('#btn-login-close')?.addEventListener('click', (e) => { e.preventDefault(); hideModal(); });

    // Crear cuenta
    $('#btn-create-account')?.addEventListener('click', async (e) => {
      e.preventDefault();
      const email = emailVal(), pass = passVal();
      if (!email || !pass) return err('Escribe email y contraseña.');
      try {
        console.log('[AUTH] createUserWithEmailAndPassword');
        await createUserWithEmailAndPassword(auth, email, pass);
        ok('Cuenta creada y sesión iniciada.');
        hideModal();
      } catch (e) {
        console.error(e);
        err(e);
      }
    });

    // Iniciar sesión
    $('#btn-login-submit')?.addEventListener('click', async (e) => {
      e.preventDefault();
      const email = emailVal(), pass = passVal();
      if (!email || !pass) return err('Escribe email y contraseña.');
      try {
        console.log('[AUTH] signInWithEmailAndPassword');
        await signInWithEmailAndPassword(auth, email, pass);
        ok('Sesión iniciada.');
        hideModal();
      } catch (e) {
        console.error(e);
        err(e);
      }
    });

    // Cerrar sesión
    $('#btn-logout')?.addEventListener('click', async (e) => {
      e.preventDefault();
      try {
        await signOut(auth);
        ok('Sesión cerrada.');
      } catch (e) {
        console.error(e);
        err(e);
      }
    });

    /* ===== Reactividad de la sesión ===== */
    onAuthStateChanged(auth, (user) => {
      console.log('[AUTH] onAuthStateChanged ->', user?.uid || null);

      const welcome = $('#welcome-message');
      const uname   = $('#user-name');
      const btnIn   = $('#btn-login-open');
      const btnOut  = $('#btn-logout');

      if (user) {
        hideModal();
        if (uname)   uname.textContent   = user.email || 'Usuario';
        if (welcome) welcome.textContent = 'Tu sesión está activa. Tus operaciones se guardarán en la nube.';
        if (btnIn)   btnIn.style.display = 'none';
        if (btnOut)  btnOut.style.display = 'inline-flex';
      } else {
        if (uname)   uname.textContent   = 'Invitado';
        if (welcome) welcome.textContent = 'Inicia sesión para guardar tus operaciones en la nube.';
        if (btnIn)   btnIn.style.display = 'inline-flex';
        if (btnOut)  btnOut.style.display = 'none';
      }
    });
  </script>
</body>
</html>
