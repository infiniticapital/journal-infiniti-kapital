{\rtf1\ansi\ansicpg1252\cocoartf2639
\cocoatextscaling0\cocoaplatform0{\fonttbl\f0\fswiss\fcharset0 Helvetica;\f1\fnil\fcharset0 AppleColorEmoji;}
{\colortbl;\red255\green255\blue255;}
{\*\expandedcolortbl;;}
\paperw11900\paperh16840\margl1440\margr1440\vieww11520\viewh8400\viewkind0
\pard\tx566\tx1133\tx1700\tx2267\tx2834\tx3401\tx3968\tx4535\tx5102\tx5669\tx6236\tx6803\pardirnatural\partightenfactor0

\f0\fs24 \cf0 <!DOCTYPE html>\
<html lang="es">\
<head>\
    <meta charset="UTF-8">\
    <meta name="viewport" content="width=device-width, initial-scale=1.0">\
    <title>INFINITI KAPITAL - Journal Profesional</title>\
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.4.0/css/all.min.css">\
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>\
    <style>\
        :root \{\
            --primary: #0f172a; --secondary: #1e293b; --accent: #d4af37;\
            --success: #10b981; --warning: #f59e0b; --danger: #ef4444;\
            --card-bg: rgba(15, 23, 42, 0.8); --border: rgba(255, 255, 255, 0.1);\
            --text-primary: #f1f5f9; --text-secondary: #94a3b8;\
        \}\
        * \{ margin: 0; padding: 0; box-sizing: border-box; font-family: 'Segoe UI', Tahoma, Geneva, Verdana, sans-serif; \}\
        body \{ background: linear-gradient(135deg, var(--primary), var(--secondary)); color: var(--text-primary); min-height: 100vh; display: grid; grid-template-columns: 240px 1fr; grid-template-rows: 70px 1fr; grid-template-areas: "sidebar header" "sidebar main"; \}\
        header \{ grid-area: header; background: var(--secondary); padding: 0 25px; display: flex; align-items: center; justify-content: space-between; border-bottom: 1px solid var(--border); box-shadow: 0 2px 10px rgba(0, 0, 0, 0.1); z-index: 10; \}\
        .header-content \{ display: flex; align-items: center; gap: 15px; \}\
        .date-display \{ font-size: 1.1rem; color: var(--text-secondary); \}\
        .user-controls \{ display: flex; align-items: center; gap: 20px; \}\
        .user-info \{ display: flex; align-items: center; gap: 10px; \}\
        .user-avatar \{ width: 40px; height: 40px; border-radius: 50%; background: var(--accent); display: flex; align-items: center; justify-content: center; font-weight: bold; color: var(--primary); \}\
        .user-name \{ font-weight: 600; color: var(--accent); \}\
        .sidebar \{ grid-area: sidebar; background: rgba(15, 23, 42, 0.95); border-right: 1px solid var(--border); display: flex; flex-direction: column; padding: 20px 0; \}\
        .logo \{ padding: 0 20px 20px; border-bottom: 1px solid var(--border); margin-bottom: 20px; \}\
        .logo-infiniti \{ font-size: 1.8rem; font-weight: 800; letter-spacing: -1px; color: white; line-height: 1; \}\
        .logo-kapital \{ font-size: 1.5rem; font-weight: 800; letter-spacing: -1px; color: var(--accent); line-height: 1; margin-top: -5px; \}\
        .nav-menu \{ display: flex; flex-direction: column; gap: 5px; padding: 0 15px; \}\
        .nav-item \{ display: flex; align-items: center; gap: 12px; padding: 12px 15px; border-radius: 8px; color: var(--text-secondary); text-decoration: none; transition: all 0.3s ease; cursor: pointer; \}\
        .nav-item:hover, .nav-item.active \{ background: rgba(212, 175, 55, 0.1); color: var(--accent); \}\
        .nav-item i \{ width: 24px; text-align: center; \}\
        main \{ grid-area: main; padding: 25px; overflow-y: auto; display: grid; grid-template-columns: 1fr; gap: 20px; \}\
        .card \{ background: var(--card-bg); border-radius: 12px; padding: 20px; box-shadow: 0 4px 6px -1px rgba(0, 0, 0, 0.1); border: 1px solid var(--border); backdrop-filter: blur(5px); \}\
        .card-header \{ display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; \}\
        .card-title \{ font-size: 1.2rem; font-weight: 600; color: var(--text-primary); \}\
        .btn-icon \{ background: transparent; border: none; color: var(--accent); font-size: 1rem; cursor: pointer; transition: all 0.3s ease; \}\
        .btn-icon:hover \{ color: #c9a227; \}\
        .section-content \{ display: none; grid-template-columns: repeat(12, 1fr); gap: 20px; \}\
        .section-content.active \{ display: grid; \}\
        .welcome-card \{ grid-column: span 8; \}\
        .metrics-summary \{ grid-column: span 4; \}\
        .profit-factor, .risk-reward, .win-trades \{ grid-column: span 4; \}\
        .distribution-card \{ grid-column: span 6; grid-row: span 2; \}\
        .recent-trades, .balance-evolution \{ grid-column: span 6; \}\
        .risk-analysis \{ grid-column: span 6; grid-row: span 2; \}\
        .news-card, .challenge-card \{ grid-column: span 6; \}\
        .metric-card \{ text-align: center; padding: 15px; border-radius: 8px; background: rgba(30, 41, 59, 0.5); \}\
        .metric-value \{ font-size: 1.8rem; font-weight: 700; color: var(--accent); margin-bottom: 5px; \}\
        .metric-label \{ font-size: 0.9rem; color: var(--text-secondary); \}\
        .metrics-grid \{ display: grid; grid-template-columns: 1fr 1fr; gap: 15px; \}\
        .summary-card \{ padding: 15px; border-radius: 8px; background: rgba(16, 185, 129, 0.1); border: 1px solid rgba(16, 185, 129, 0.2); margin-top: 15px; \}\
        .chart-container \{ height: 300px; margin-top: 15px; \}\
        .trades-grid \{ display: grid; grid-template-columns: repeat(auto-fill, minmax(150px, 1fr)); gap: 15px; margin-top: 15px; \}\
        .trade-item \{ background: rgba(30, 41, 59, 0.5); border-radius: 8px; padding: 15px; border: 1px solid var(--border); \}\
        .trade-pair \{ font-weight: 600; font-size: 1.1rem; margin-bottom: 5px; color: var(--accent); \}\
        .trade-amount \{ font-size: 1.3rem; font-weight: 700; margin-bottom: 8px; \}\
        .trade-profit \{ color: var(--success); \} .trade-loss \{ color: var(--danger); \}\
        .trade-meta \{ display: flex; justify-content: space-between; color: var(--text-secondary); font-size: 0.85rem; \}\
        .modal \{ display: none; position: fixed; top: 0; left: 0; width: 100%; height: 100%; background: rgba(0, 0, 0, 0.7); z-index: 1000; align-items: center; justify-content: center; \}\
        .modal-content \{ background: var(--card-bg); border-radius: 16px; width: 90%; max-width: 500px; padding: 25px; border: 1px solid var(--accent); box-shadow: 0 15px 35px rgba(0, 0, 0, 0.5); \}\
        .modal-header \{ display: flex; justify-content: space-between; align-items: center; margin-bottom: 20px; border-bottom: 1px solid var(--accent); padding-bottom: 15px; \}\
        .modal-header h2 \{ color: var(--accent); font-size: 1.5rem; \}\
        .close-modal \{ background: none; border: none; color: #94a3b8; font-size: 1.5rem; cursor: pointer; \}\
        .form-group \{ margin-bottom: 20px; \}\
        .form-group label \{ display: block; margin-bottom: 8px; color: var(--text-secondary); font-weight: 500; \}\
        .form-control \{ width: 100%; padding: 12px; background: rgba(15, 23, 42, 0.5); border: 1px solid var(--border); border-radius: 8px; color: var(--text-primary); font-size: 1rem; \}\
        .modal-footer \{ display: flex; justify-content: flex-end; gap: 10px; \}\
        .btn-primary \{ background: var(--accent); color: var(--primary); border: none; padding: 10px 20px; border-radius: 8px; font-weight: 600; cursor: pointer; display: inline-flex; align-items: center; gap: 8px;\}\
        .btn-secondary \{ background: #334155; color: white; border: none; padding: 10px 20px; border-radius: 8px; cursor: pointer; \}\
        .add-trade-btn \{ position: fixed; bottom: 30px; right: 30px; width: 60px; height: 60px; border-radius: 50%; background: var(--accent); color: var(--primary); border: none; font-size: 1.5rem; cursor: pointer; box-shadow: 0 4px 10px rgba(0, 0, 0, 0.3); display: flex; align-items: center; justify-content: center; z-index: 100; \}\
        .section-card \{ grid-column: span 12; \}\
        .empty-state \{ text-align: center; padding: 40px 20px; color: var(--text-secondary); grid-column: 1 / -1; \}\
        .empty-state i \{ font-size: 3rem; margin-bottom: 15px; color: var(--accent); \}\
        .accounts-grid \{ display: grid; grid-template-columns: repeat(auto-fill, minmax(300px, 1fr)); gap: 20px; margin-top: 20px; \}\
        .account-card \{ background: rgba(30, 41, 59, 0.5); border-radius: 12px; padding: 20px; border: 1px solid var(--border); position: relative; \}\
        .account-header \{ display: flex; justify-content: space-between; align-items: center; margin-bottom: 15px; \}\
        .account-type \{ font-size: 0.9rem; padding: 5px 10px; border-radius: 20px; font-weight: 600; \}\
        .type-principal \{ background: rgba(212, 175, 55, 0.2); color: var(--accent); \}\
        .type-challenge \{ background: rgba(16, 185, 129, 0.2); color: var(--success); \}\
        .type-personal \{ background: rgba(59, 130, 246, 0.2); color: #3b82f6; \}\
        .account-actions button \{ background: transparent; border: none; color: var(--text-secondary); cursor: pointer; font-size: 1rem; transition: color 0.3s; \}\
        .account-balance \{ font-size: 2rem; font-weight: 700; margin-bottom: 10px; color: var(--accent); \}\
        .account-name \{ font-size: 1.2rem; color: var(--text-primary); margin-bottom: 10px; \}\
        .add-account-btn \{ display: flex; align-items: center; justify-content: center; background: rgba(30, 41, 59, 0.5); border: 2px dashed var(--border); border-radius: 12px; padding: 20px; cursor: pointer; transition: all 0.3s ease; flex-direction: column; min-height: 195px; \}\
        .add-account-btn:hover \{ border-color: var(--accent); background: rgba(212, 175, 55, 0.1); \}\
        .add-account-btn i \{ font-size: 2.5rem; margin-bottom: 15px; color: var(--accent); \}\
        @media (max-width: 1200px) \{ .welcome-card, .metrics-summary, .distribution-card, .recent-trades, .balance-evolution, .risk-analysis, .news-card, .challenge-card \{ grid-column: span 12; \} .profit-factor, .risk-reward, .win-trades \{ grid-column: span 4; \} \}\
        @media (max-width: 768px) \{ body \{ grid-template-columns: 1fr; grid-template-areas: "header" "main"; \} .sidebar \{ display: none; \} .profit-factor, .risk-reward, .win-trades, .trades-grid, .risk-levels, .accounts-grid \{ grid-template-columns: 1fr; \} \}\
        .prose-custom \{ line-height: 1.6; \}\
        .prose-custom h3 \{ margin-bottom: 0.5rem; font-weight: 600; color: var(--accent); \}\
        .prose-custom strong \{ color: var(--text-primary); \}\
        .prose-custom p \{ margin-bottom: 1rem; \}\
    </style>\
</head>\
<body>\
    <div id="app-root" class="contents">\
        <!-- Sidebar -->\
        <aside class="sidebar">\
            <div class="logo">\
                <div class="logo-infiniti">INFINITI</div>\
                <div class="logo-kapital">KAPITAL</div>\
            </div>\
            <nav class="nav-menu">\
                <a href="#" class="nav-item active" data-target="dashboard-content"><i class="fas fa-chart-line"></i><span>Dashboard</span></a>\
                <a href="#" class="nav-item" data-target="cuentas-content"><i class="fas fa-wallet"></i><span>Cuentas</span></a>\
                <a href="#" class="nav-item" data-target="analiticas-content"><i class="fas fa-chart-bar"></i><span>Anal\'edticas</span></a>\
                <a href="#" class="nav-item" data-target="calendario-content"><i class="fas fa-calendar"></i><span>Calendario</span></a>\
                <a href="#" class="nav-item" data-target="seguimiento-content"><i class="fas fa-tasks"></i><span>Seguimiento</span></a>\
            </nav>\
        </aside>\
        \
        <!-- Header -->\
        <header>\
            <div class="header-content"><div class="date-display"><i class="fas fa-calendar"></i> <span id="current-date"></span></div></div>\
            <div class="user-controls">\
                <div class="user-info"><div class="user-avatar">IK</div><div class="user-name">Invitado</div></div>\
                <button class="btn-icon"><i class="fas fa-bell"></i></button>\
            </div>\
        </header>\
        \
        <!-- Main Content -->\
        <main>\
            <!-- Dashboard Section -->\
            <div id="dashboard-content" class="section-content active">\
                <div class="card welcome-card"><div class="card-header"><h2 class="card-title">Bienvenido</h2></div><p id="welcome-message">Cargando datos...</p></div>\
                <div class="card metrics-summary"><div class="card-header"><h2 class="card-title">Resumen</h2></div><div class="metrics-grid"><div class="metric-card"><div class="metric-value" id="total-profit">$0.00</div><div class="metric-label">Beneficio Total</div></div><div class="metric-card"><div class="metric-value" id="win-rate">0%</div><div class="metric-label">Tasa de Acierto</div></div></div></div>\
                <div class="card profit-factor"><div class="card-header"><h2 class="card-title">Factor de Beneficio</h2></div><div class="metric-card"><div class="metric-value" id="profit-factor">0.00</div><div class="metric-label">Total: <span id="total-trades">0</span></div></div></div>\
                <div class="card risk-reward"><div class="card-header"><h2 class="card-title">Riesgo/Beneficio</h2></div><div class="metric-card"><div class="metric-value" id="risk-reward">0.00</div><div class="metric-label">Ratio Promedio</div></div></div>\
                <div class="card win-trades"><div class="card-header"><h2 class="card-title">Operaciones Ganadoras</h2></div><div class="metric-card"><div class="metric-value" id="win-trades">0</div><div class="metric-label">de <span id="total-trades-2">0</span></div></div></div>\
                <div class="card distribution-card"><div class="card-header"><h2 class="card-title">Distribuci\'f3n</h2></div><div class="chart-container"><canvas id="distributionChart"></canvas></div></div>\
                <div class="card recent-trades"><div class="card-header"><h2 class="card-title">Recientes</h2></div><div class="trades-grid" id="recent-trades-container"><div class="empty-state"><i class="fas fa-spinner fa-spin"></i></div></div></div>\
                <div class="card balance-evolution"><div class="card-header"><h2 class="card-title">Evoluci\'f3n de Saldo</h2></div><div class="chart-container"><canvas id="balanceChart"></canvas></div></div>\
                <div class="card risk-analysis"><div class="card-header"><h2 class="card-title">An\'e1lisis de Riesgo</h2></div><div class="chart-container"><canvas id="riskChart"></canvas></div></div>\
            </div>\
            \
            <div id="cuentas-content" class="section-content"><div class="card section-card"><div class="card-header"><h2 class="card-title">Gesti\'f3n de Cuentas</h2></div><div class="accounts-grid" id="accounts-container"><div class="empty-state"><i class="fas fa-spinner fa-spin"></i></div></div></div></div>\
            <div id="analiticas-content" class="section-content"><div class="card section-card"><div class="card-header"><h2 class="card-title">An\'e1lisis con IA</h2><button id="psychology-report-btn" class="btn-primary">
\f1 \uc0\u55358 \u56800 
\f0  Generar Reporte</button></div><div id="analytics-result-container" class="prose-custom p-4 mt-4 bg-gray-900/50 rounded-lg min-h-[200px]"><div class="empty-state"><i class="fas fa-magic"></i><h3>An\'e1lisis Avanzado</h3><p>Genera un reporte psicol\'f3gico basado en tu historial.</p></div></div></div></div>\
            <div id="calendario-content" class="section-content"><div class="card section-card"><div class="empty-state"><i class="fas fa-calendar"></i><h3>Pr\'f3ximamente</h3></div></div></div>\
            <div id="seguimiento-content" class="section-content"><div class="card section-card"><div class="empty-state"><i class="fas fa-tasks"></i><h3>Pr\'f3ximamente</h3></div></div></div>\
        </main>\
        \
        <button class="add-trade-btn" id="floating-add-trade-btn"><i class="fas fa-plus"></i></button>\
        \
        <div id="add-trade-modal" class="modal"><div class="modal-content"><div class="modal-header"><h2>Agregar Operaci\'f3n</h2><button class="close-modal">&times;</button></div><form><div class="modal-body"><div class="form-group"><label for="trade-pair-input">Par</label><select id="trade-pair-input" class="form-control"><option value="EURUSD">EUR/USD</option><option value="GBPUSD">GBP/USD</option><option value="USDJPY">USD/JPY</option></select></div><div class="form-group"><label for="trade-type-input">Tipo</label><select id="trade-type-input" class="form-control"><option value="buy">Compra</option><option value="sell">Venta</option></select></div><div class="form-group"><label for="trade-result-input">Resultado ($)</label><input type="number" id="trade-result-input" class="form-control" placeholder="Ej: 250.50" step="0.01"></div></div><div class="modal-footer"><button type="button" class="btn-secondary" id="cancel-trade-btn">Cancelar</button><button type="submit" class="btn-primary" id="save-trade-btn">Guardar</button></div></form></div></div>\
        <div id="add-account-modal" class="modal"><div class="modal-content"><div class="modal-header"><h2 id="account-modal-title">Agregar Cuenta</h2><button class="close-modal">&times;</button></div><form><div class="modal-body"><div class="form-group"><label for="account-name">Nombre</label><input type="text" id="account-name" class="form-control" placeholder="Ej: Cuenta Principal"></div><div class="form-group"><label for="account-balance">Saldo ($)</label><input type="number" id="account-balance" class="form-control" placeholder="Ej: 10000.00" step="0.01"></div><div class="form-group"><label for="account-type">Tipo</label><select id="account-type" class="form-control"><option value="principal">Principal</option><option value="challenge">Challenge</option><option value="personal">Personal</option></select></div><input type="hidden" id="editing-account-id"></div><div class="modal-footer"><button type="button" class="btn-secondary" id="cancel-account-btn">Cancelar</button><button type="submit" class="btn-primary" id="save-account-btn">Guardar</button></div></form></div></div>\
    </div>\
\
    <script type="module">\
        import \{ initializeApp \} from "https://www.gstatic.com/firebasejs/11.6.1/firebase-app.js";\
        import \{ getAuth, signInAnonymously, onAuthStateChanged, signInWithCustomToken \} from "https://www.gstatic.com/firebasejs/11.6.1/firebase-auth.js";\
        import \{ getFirestore, collection, addDoc, onSnapshot, serverTimestamp, query, doc, deleteDoc, updateDoc \} from "https://www.gstatic.com/firebasejs/11.6.1/firebase-firestore.js";\
        \
        try \{\
            const firebaseConfigStr = typeof __firebase_config !== 'undefined' ? __firebase_config : '\{\}';\
            const firebaseConfig = JSON.parse(firebaseConfigStr);\
            if (!firebaseConfig.apiKey) throw new Error("La configuraci\'f3n de Firebase est\'e1 ausente o incompleta. Sigue la gu\'eda para configurarla.");\
\
            const app = initializeApp(firebaseConfig);\
            const auth = getAuth(app);\
            const db = getFirestore(app);\
            const appId = (typeof __app_id !== 'undefined' ? __app_id : 'default-app-id').replace(/\\//g, '_');\
            \
            let userId = null;\
            let allTrades = [];\
            let allAccounts = [];\
            let distributionChart, balanceChart, riskChart;\
\
            // --- DOM Elements ---\
            const ui = \{\
                addTradeModal: document.getElementById('add-trade-modal'),\
                addAccountModal: document.getElementById('add-account-modal'),\
                openModalButtons: document.querySelectorAll('#add-trade-btn, #floating-add-trade-btn'),\
                saveTradeBtn: document.getElementById('save-trade-btn'),\
                saveAccountBtn: document.getElementById('save-account-btn'),\
                recentTradesContainer: document.getElementById('recent-trades-container'),\
                accountsContainer: document.getElementById('accounts-container'),\
                psychologyReportBtn: document.getElementById('psychology-report-btn'),\
                analyticsResultContainer: document.getElementById('analytics-result-container'),\
            \};\
\
            // --- Navigation ---\
            document.querySelectorAll('.nav-item').forEach(item => \{\
                item.addEventListener('click', function(e) \{\
                    e.preventDefault();\
                    document.querySelectorAll('.nav-item').forEach(i => i.classList.remove('active'));\
                    this.classList.add('active');\
                    const targetId = this.getAttribute('data-target');\
                    document.querySelectorAll('.section-content').forEach(s => s.classList.remove('active'));\
                    const targetSection = document.getElementById(targetId);\
                    if (targetSection) targetSection.classList.add('active');\
                \});\
            \});\
\
            // --- Authentication ---\
            onAuthStateChanged(auth, async user => \{\
                if (user) \{\
                    userId = user.uid;\
                    loadData();\
                \} else \{\
                    try \{\
                        if (typeof __initial_auth_token !== 'undefined') await signInWithCustomToken(auth, __initial_auth_token);\
                        else await signInAnonymously(auth);\
                    \} catch (error) \{ console.error("Authentication error:", error); \}\
                \}\
            \});\
\
            // --- Data Loading ---\
            function loadData() \{\
                if (!userId) return;\
                initCharts();\
                \
                const tradesQuery = query(collection(db, `artifacts/$\{appId\}/users/$\{userId\}/trades`));\
                onSnapshot(tradesQuery, snapshot => \{\
                    allTrades = snapshot.docs.map(doc => (\{ id: doc.id, ...doc.data() \}));\
                    allTrades.sort((a, b) => (b.timestamp?.toMillis() || 0) - (a.timestamp?.toMillis() || 0));\
                    updateDashboardUI();\
                \});\
\
                const accountsQuery = query(collection(db, `artifacts/$\{appId\}/users/$\{userId\}/accounts`));\
                onSnapshot(accountsQuery, snapshot => \{\
                    allAccounts = snapshot.docs.map(doc => (\{ id: doc.id, ...doc.data() \}));\
                    renderAccounts();\
                \});\
            \}\
\
            // --- UI Updates & Rendering ---\
            function updateDashboardUI() \{\
                const totalTrades = allTrades.length;\
                const winTrades = allTrades.filter(t => t.result > 0).length;\
                const totalProfit = allTrades.reduce((sum, t) => sum + t.result, 0);\
                const winRate = totalTrades > 0 ? (winTrades / totalTrades) * 100 : 0;\
                \
                const grossProfit = allTrades.filter(t => t.result > 0).reduce((s, t) => s + t.result, 0);\
                const grossLoss = Math.abs(allTrades.filter(t => t.result < 0).reduce((s, t) => s + t.result, 0));\
                const profitFactor = grossLoss > 0 ? grossProfit / grossLoss : 0;\
\
                document.getElementById('total-profit').textContent = `$$\{totalProfit.toFixed(2)\}`;\
                document.getElementById('win-rate').textContent = `$\{winRate.toFixed(1)\}%`;\
                document.getElementById('profit-factor').textContent = profitFactor.toFixed(2);\
                document.getElementById('win-trades').textContent = winTrades;\
                document.getElementById('total-trades').textContent = totalTrades;\
                document.getElementById('total-trades-2').textContent = totalTrades;\
                 document.getElementById('welcome-message').textContent = totalTrades > 0 ? `Has completado $\{totalTrades\} operaciones.` : 'A\'fan no has realizado operaciones.';\
                \
                renderRecentTrades();\
                updateCharts();\
            \}\
\
            function renderRecentTrades() \{\
                if (allTrades.length === 0) \{\
                    ui.recentTradesContainer.innerHTML = `<div class="empty-state"><i class="fas fa-file-alt"></i><h3>No hay operaciones</h3></div>`;\
                    return;\
                \}\
                const recent = allTrades.slice(0, 4);\
                ui.recentTradesContainer.innerHTML = recent.map(trade => \{\
                    const profitClass = trade.result >= 0 ? 'trade-profit' : 'trade-loss';\
                    const sign = trade.result >= 0 ? '+' : '';\
                    const date = trade.timestamp ? new Date(trade.timestamp.seconds * 1000).toLocaleDateString('es-ES', \{day:'2-digit', month:'2-digit'\}) : 'N/A';\
                    return `<div class="trade-item">\
                                <div class="trade-pair">$\{trade.pair\}</div>\
                                <div class="trade-amount $\{profitClass\}">$\{sign\}$$\{Math.abs(trade.result).toFixed(2)\}</div>\
                                <div class="trade-meta"><span>$\{date\}</span><span>$\{trade.type.toUpperCase()\}</span></div>\
                            </div>`;\
                \}).join('');\
            \}\
            \
            function renderAccounts() \{\
                let html = `<div class="add-account-btn"><i class="fas fa-plus"></i><span>Agregar Cuenta</span></div>`;\
                if (allAccounts.length > 0) \{\
                    html += allAccounts.map(account => \{\
                        const typeClasses = \{ principal: 'type-principal', challenge: 'type-challenge', personal: 'type-personal' \};\
                        return `<div class="account-card" data-id="$\{account.id\}">\
                                    <div class="account-header">\
                                        <div class="account-type $\{typeClasses[account.type]\}">$\{account.type.charAt(0).toUpperCase() + account.type.slice(1)\}</div>\
                                        <div class="account-actions">\
                                            <button class="edit-account" data-id="$\{account.id\}"><i class="fas fa-edit"></i></button>\
                                            <button class="delete-account" data-id="$\{account.id\}"><i class="fas fa-trash"></i></button>\
                                        </div>\
                                    </div>\
                                    <div class="account-balance">$$\{account.balance.toFixed(2)\}</div>\
                                    <div class="account-name">$\{account.name\}</div>\
                                </div>`;\
                    \}).join('');\
                \}\
                ui.accountsContainer.innerHTML = html;\
            \}\
\
            // --- CRUD Operations ---\
            async function handleSaveTrade(e) \{\
                e.preventDefault();\
                const newTrade = \{\
                    pair: document.getElementById('trade-pair-input').value,\
                    type: document.getElementById('trade-type-input').value,\
                    result: parseFloat(document.getElementById('trade-result-input').value) || 0,\
                    timestamp: serverTimestamp()\
                \};\
                await addDoc(collection(db, `artifacts/$\{appId\}/users/$\{userId\}/trades`), newTrade);\
                ui.addTradeModal.style.display = 'none';\
                e.target.closest('form').reset();\
            \}\
\
            async function handleSaveAccount(e) \{\
                e.preventDefault();\
                const editingId = document.getElementById('editing-account-id').value;\
                const accountData = \{\
                    name: document.getElementById('account-name').value,\
                    balance: parseFloat(document.getElementById('account-balance').value) || 0,\
                    type: document.getElementById('account-type').value,\
                \};\
\
                if (editingId) \{\
                    await updateDoc(doc(db, `artifacts/$\{appId\}/users/$\{userId\}/accounts`, editingId), accountData);\
                \} else \{\
                    await addDoc(collection(db, `artifacts/$\{appId\}/users/$\{userId\}/accounts`), accountData);\
                \}\
                ui.addAccountModal.style.display = 'none';\
            \}\
\
            async function deleteAccount(id) \{\
                if (confirm('\'bfEst\'e1s seguro de que quieres eliminar esta cuenta?')) \{\
                    await deleteDoc(doc(db, `artifacts/$\{appId\}/users/$\{userId\}/accounts`, id));\
                \}\
            \}\
\
            // --- Modals ---\
            function openAccountModal(account = null) \{\
                const form = ui.addAccountModal.querySelector('form');\
                form.reset();\
                if (account) \{\
                    document.getElementById('account-modal-title').textContent = 'Editar Cuenta';\
                    document.getElementById('account-name').value = account.name;\
                    document.getElementById('account-balance').value = account.balance;\
                    document.getElementById('account-type').value = account.type;\
                    document.getElementById('editing-account-id').value = account.id;\
                \} else \{\
                    document.getElementById('account-modal-title').textContent = 'Agregar Nueva Cuenta';\
                    document.getElementById('editing-account-id').value = '';\
                \}\
                ui.addAccountModal.style.display = 'flex';\
            \}\
            \
            // --- Gemini AI ---\
            ui.psychologyReportBtn.addEventListener('click', async () => \{\
                if (allTrades.length < 3) \{\
                    ui.analyticsResultContainer.innerHTML = `<div class="empty-state"><h3>Datos Insuficientes</h3><p>Necesitas al menos 3 operaciones para generar un reporte.</p></div>`; return;\
                \}\
                ui.analyticsResultContainer.innerHTML = `<div class="empty-state"><i class="fas fa-spinner fa-spin"></i><h3>Generando Reporte...</h3></div>`;\
                const tradesForPrompt = allTrades.map(t => (\{ result: t.result, pair: t.pair \}));\
                const prompt = `Eres un psic\'f3logo de trading. Analiza este historial de $\{allTrades.length\} operaciones: $\{JSON.stringify(tradesForPrompt)\}. Proporciona: 1. Un h\'e1bito positivo observado. 2. Un \'e1rea de mejora emocional. 3. Una recomendaci\'f3n pr\'e1ctica. S\'e9 conciso, usa markdown.`;\
                try \{\
                    const result = await callGeminiAPI(prompt);\
                    ui.analyticsResultContainer.innerHTML = result;\
                \} catch (error) \{ ui.analyticsResultContainer.innerHTML = `<div class="empty-state"><i class="fas fa-exclamation-triangle"></i><h3>Error</h3><p>$\{error.message\}</p></div>`; \}\
            \});\
\
            async function callGeminiAPI(prompt) \{\
                const apiKey = ""; const apiUrl = `https://generativelanguage.googleapis.com/v1beta/models/gemini-2.5-flash-preview-05-20:generateContent?key=$\{apiKey\}`;\
                const payload = \{ contents: [\{ parts: [\{ text: prompt \}] \}] \};\
                const response = await fetch(apiUrl, \{ method: 'POST', headers: \{ 'Content-Type': 'application/json' \}, body: JSON.stringify(payload) \});\
                if (!response.ok) throw new Error(`API Error: $\{response.statusText\}`);\
                const result = await response.json();\
                const text = result.candidates?.[0]?.content?.parts?.[0]?.text;\
                if (text) return text.replace(/\\n/g, '<br>').replace(/\\*\\*(.*?)\\*\\*/g, '<strong>$1</strong>');\
                throw new Error("Respuesta inv\'e1lida de la API.");\
            \}\
\
            // --- Event Listeners ---\
            function setupEventListeners() \{\
                updateCurrentDate();\
                ui.openModalButtons.forEach(b => b.addEventListener('click', () => ui.addTradeModal.style.display = 'flex'));\
                \
                document.querySelectorAll('.close-modal, #cancel-trade-btn, #cancel-account-btn').forEach(b => b.addEventListener('click', () => \{\
                    ui.addTradeModal.style.display = 'none';\
                    ui.addAccountModal.style.display = 'none';\
                \}));\
                \
                ui.addTradeModal.querySelector('form').addEventListener('submit', handleSaveTrade);\
                ui.addAccountModal.querySelector('form').addEventListener('submit', handleSaveAccount);\
\
                ui.accountsContainer.addEventListener('click', e => \{\
                    if (e.target.closest('.add-account-btn')) openAccountModal();\
                    if (e.target.closest('.edit-account')) \{\
                        const id = e.target.closest('.edit-account').dataset.id;\
                        const account = allAccounts.find(a => a.id === id);\
                        if(account) openAccountModal(account);\
                    \}\
                    if (e.target.closest('.delete-account')) \{\
                        const id = e.target.closest('.delete-account').dataset.id;\
                        deleteAccount(id);\
                    \}\
                \});\
            \}\
            \
            // --- Charting ---\
            function initCharts()\{\
                const chartOptions = \{ responsive: true, maintainAspectRatio: false, plugins: \{ legend: \{ labels: \{ color: '#f1f5f9' \} \} \}, scales: \{ y: \{ beginAtZero: true, grid: \{ color: 'rgba(255, 255, 255, 0.1)' \}, ticks: \{ color: '#94a3b8' \} \}, x: \{ grid: \{ display: false \}, ticks: \{ color: '#94a3b8' \} \} \} \};\
                const radarOptions = \{ responsive: true, maintainAspectRatio: false, scales: \{ r: \{ angleLines: \{ color: 'rgba(255, 255, 255, 0.1)' \}, grid: \{ color: 'rgba(255, 255, 255, 0.1)' \}, pointLabels: \{ color: '#94a3b8' \}, ticks: \{ display: false \} \} \}, plugins: \{ legend: \{ labels: \{ color: '#f1f5f9' \} \} \} \};\
\
                const distCtx = document.getElementById('distributionChart')?.getContext('2d');\
                if (distCtx) distributionChart = new Chart(distCtx, \{ type: 'bar', data: \{ labels: ['Ganadoras', 'Perdedoras'], datasets: [\{ data: [0, 0], backgroundColor: [ 'rgba(16, 185, 129, 0.7)', 'rgba(239, 68, 68, 0.7)'], borderWidth: 1 \}] \}, options: chartOptions \});\
\
                const balanceCtx = document.getElementById('balanceChart')?.getContext('2d');\
                if (balanceCtx) balanceChart = new Chart(balanceCtx, \{ type: 'line', data: \{ labels: [], datasets: [\{ label: 'Saldo', data: [], borderColor: 'rgba(212, 175, 55, 1)', fill: true, tension: 0.3 \}] \}, options: chartOptions \});\
\
                const riskCtx = document.getElementById('riskChart')?.getContext('2d');\
                if (riskCtx) riskChart = new Chart(riskCtx, \{ type: 'radar', data: \{ labels: ['Acierto', 'Beneficio', 'R/B', 'Consistencia'], datasets: [\{ label: 'Perfil', data: [0,0,0,0], backgroundColor: 'rgba(212, 175, 55, 0.2)', borderColor: 'rgba(212, 175, 55, 1)' \}] \}, options: radarOptions \});\
            \}\
\
            function updateCharts() \{\
                if (!distributionChart || !balanceChart || !riskChart) return;\
\
                // Distribution Chart\
                const wins = allTrades.filter(t => t.result > 0).length;\
                const losses = allTrades.filter(t => t.result < 0).length;\
                distributionChart.data.datasets[0].data = [wins, losses];\
                distributionChart.update();\
\
                // Balance Chart\
                const principalAccount = allAccounts.find(a => a.type === 'principal') || \{ balance: 10000 \};\
                let runningBalance = principalAccount.balance;\
                const balanceData = [runningBalance];\
                const balanceLabels = ['Inicio'];\
                [...allTrades].reverse().forEach((trade, index) => \{\
                    runningBalance += trade.result;\
                    balanceData.push(runningBalance);\
                    balanceLabels.push(`Op $\{index + 1\}`);\
                \});\
                balanceChart.data.labels = balanceLabels;\
                balanceChart.data.datasets[0].data = balanceData;\
                balanceChart.update();\
                \
                // Risk Chart\
                const winRate = allTrades.length > 0 ? (wins / allTrades.length) * 100 : 0;\
                const grossProfit = allTrades.filter(t => t.result > 0).reduce((s, t) => s + t.result, 0);\
                const grossLoss = Math.abs(allTrades.filter(t => t.result < 0).reduce((s, t) => s + t.result, 0));\
                const profitFactor = grossLoss > 0 ? grossProfit / grossLoss : 0;\
                // Normalize for radar: winRate is 0-100, profit factor can be anything. Let's cap it at 5 and scale.\
                const riskData = [ winRate, Math.min(100, (grossProfit / principalAccount.balance)*100 || 0) , Math.min(100, profitFactor * 20), 50 ]; // 50 for consistency placeholder\
                riskChart.data.datasets[0].data = riskData;\
                riskChart.update();\
            \}\
\
            function updateCurrentDate() \{\
                const now = new Date();\
                const options = \{ weekday: 'long', year: 'numeric', month: 'long', day: 'numeric' \};\
                document.getElementById('current-date').textContent = now.toLocaleDateString('es-ES', options);\
            \}\
\
            setupEventListeners();\
\
        \} catch (error) \{\
            console.error("Initialization Error:", error);\
            document.getElementById('app-root').innerHTML = `<div style="color:white; padding: 2rem; text-align: center; width: 100vw; height: 100vh; display: flex; align-items: center; justify-content: center; flex-direction: column;"><h1>Error de Configuraci\'f3n</h1><p style="max-width: 500px;">$\{error.message\}</p></div>`;\
        \}\
    </script>\
</body>\
</html>\
\
\
}